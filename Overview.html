<!DOCTYPE html>
<html>
  <head>
    <title>
      The Screen Orientation API
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' class=
    'remove'>
    </script>
    <script class='remove'>
      var respecConfig = {
        specStatus:           "ED",
        shortName:            "screen-orientation",

        publishDate:          "2014-02-17",
        previousPublishDate:  "2012-12-06",
        previousMaturity:     "WD",
        edDraftURI:           "http://dvcs.w3.org/hg/screen-orientation/raw-file/tip/Overview.html",

        // if this is a LCWD, uncomment and set the end of its review period
        // lcEnd: "20015-08-05",
        noIDLIn:       true,
        noLegacyStyle: true,

        editors:  [
            {
              name: "Mounir Lamouri",
              company: "Google Inc.",
              companyURL: "http://google.com/",
              note: "previously Mozilla",
            },
        ],

        wg:           "Web Applications Working Group",
        wgURI:        "http://www.w3.org/2008/webapps/",
        wgPublicList: "public-webapps",
        wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/42538/status",
      };
    </script>
  </head>
  <body>
    <section id='abstract'>
      The <cite>Screen Orientation API</cite> provides the ability to read the
      screen orientation state, to be informed when this state changes, and to
      be able to lock the screen orientation to a specific state.
    </section>
    <section id='sotd'>
      This document is still in a work in progress state. You can have a look at
      the <a href='https://www.w3.org/Bugs/Public/buglist.cgi?bug_status=UNCONFIRMED&bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&component=Screen%20Orientation&product=WebAppsWG'>
      opened bugs</a>. If you see any problem that is not in that list, feel
      free to discuss it in the mailing list (see below) or <a href='https://www.w3.org/Bugs/Public/enter_bug.cgi?product=WebAppsWG&component=Screen%20Orientation'>
      open a new bug</a>.
    </section>
    <section class='informative'>
      <h2>
        Introduction
      </h2>
      <p>
        The Screen Orientation API provides an interface for web applications
        to access and lock the device's screen orientation state.
      </p>
      <p>
        This examples is an application that shows the current screen
        orientation to the user every time the screen orientation state
        changes:
      </p>
      <pre class='example highlight'>
        &lt;!DOCTYPE html&gt;
        &lt;html&gt;
          &lt;head&gt;
            &lt;title&gt;Screen Orientation API Example 1&lt;/title&gt;
            &lt;script&gt;
              function show() {
                alert("Screen orientation state is now " + screen.orientation);
              }

              screen.addEventListener("orientationchange", show);
              window.addEventListener("load", show);
            &lt;/script&gt;
          &lt;/head&gt;
          &lt;body&gt;
            &lt;input type='button' value='Unlock'
              onclick='screen.unlockOrientation();'&gt;
            &lt;input type='button' value='Lock to portrait'
              onclick="screen.lockOrientation('portrait');"&gt;
            &lt;input type='button' value='Lock to landscape'
              onclick="screen.lockOrientation('landscape');"&gt;
          &lt;/body&gt;
        &lt;/html&gt;

</pre>
    </section>
    <section id='conformance'>
      <p>
        This specification defines conformance criteria that apply to a single
        product: the <dfn>user agent</dfn> that implements the interfaces that
        it contains.
      </p>
      <p>
        Implementations that use ECMAScript to expose the APIs defined in this
        specification MUST implement them in a manner consistent with the
        ECMAScript Bindings defined in the Web IDL specification [[!WEBIDL]].
      </p>
    </section>
    <section>
      <h2>
        Terminology
      </h2>
      <p>
        The <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#eventhandler">EventHandler</a></dfn>
        interface represents a callback used for event handlers as defined in
        [[!HTML5]].
      </p>
      <p>
        The concepts <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#queue-a-task">queue a
        task</a></dfn> and <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#fire-a-simple-event">fire
        a simple event</a></dfn> are defined in [[!HTML5]].<br>
        Unless specified otherwise, when queuing a task, the <dfn>screen
        orientation task source</dfn> is used.
      </p>
      <p>
        The terms <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#event-handlers">event
        handlers</a></dfn> and <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#event-handler-event-type">
        event handler event types</a></dfn> are defined in [[!HTML5]].
      </p>
      <p>
        The concepts of <dfn><a href=
        "http://dev.w3.org/html5/spec/browsers.html#browsing-context">browsing
        context</a></dfn> and <dfn><a href=
        "http://dev.w3.org/html5/spec/browsers.html#active-document">active
        document</a></dfn> are defined in [[!HTML5]].
      </p>
      <section>
        <h2>
          Current orientation
        </h2>
        <p>
          The <dfn>current orientation</dfn> is represented by one of the
          following values:
        </p>
        <dl>
          <dt>
            <code>portrait-primary</code>
          </dt>
          <dd>
            The orientation is in the primary portrait mode.
          </dd>
          <dt>
            <code>portrait-secondary</code>
          </dt>
          <dd>
            The orientation is in the secondary portrait mode.
          </dd>
          <dt>
            <code>landscape-primary</code>
          </dt>
          <dd>
            The orientation is in the primary landscape mode.
          </dd>
          <dt>
            <code>landscape-secondary</code>
          </dt>
          <dd>
            The orientation is in the secondary landscape mode.
          </dd>
        </dl>
        <p>
          The concepts of primary orientation and secondary orientation depends
          on the device and the platform. Some devices are in portrait mode when
          the user holds the device in the normal orientation, other devices are
          in landscape mode when the user holds the device in its normal
          orientation. For devices whose normal orientation is a landscape mode,
          that normal orientation SHOULD be represented as
          <code>landscape-primary</code>. For devices whose normal orientation
          is a portrait mode, that normal orientation SHOULD be represented as
          <code>portrait-primary</code>. In both if the device is in
          <code>landscape-primary</code> and is rotated 90 degrees clockwise,
          that SHOULD be represented as <code>portrait-primary</code>.
        </p>
      </section>
      <section>
        <h2>
          Allowed orientations
        </h2>
        <p>
          The <dfn>allowed orientations</dfn> are represented by the following
          values:
        </p>
        <dl>
          <dt>
            <code>portrait-primary</code>
          </dt>
          <dd>
            The orientation is in the primary portrait mode.
          </dd>
          <dt>
            <code>portrait-secondary</code>
          </dt>
          <dd>
            The orientation is in the secondary portrait mode.
          </dd>
          <dt>
            <code>landscape-primary</code>
          </dt>
          <dd>
            The orientation is in the primary landscape mode.
          </dd>
          <dt>
            <code>landscape-secondary</code>
          </dt>
          <dd>
            The orientation is in the secondary landscape mode.
          </dd>
          <dt>
            <code>portrait</code>
          </dt>
          <dd>
            The orientation is either <code>portrait-primary</code> or
            <code>portrait-secondary</code>.
          </dd>
          <dt>
            <code>landscape</code>
          </dt>
          <dd>
            The orientation is either <code>landscape-primary</code> or
            <code>landscape-secondary</code>.
          </dd>
        </dl>
        <ul>
        </ul>
      </section>
      <section>
        <h2>
          Locking the orientation
        </h2>
        <p>
          To <dfn>lock the orientation</dfn> means forcing the rendering of the
          current <a>browsing context</a> to behave as if the screen was
          naturally orientated in a given orientation and will only change
          orientation to a given set of <a>allowed orientations</a>, regardless
          of the actual screen orientation relative to the user or the previous
          locks.
        </p>
        <p>
          If the lock is done on only one orientation, the screen orientation
          MUST stay on the given orientation and never change until the
          screen orientation is locked again. Otherwise, the screen orientation
          MUST be able to change from an orientation to another as long as
          the orientations are amongst an orientation it has been locked to.
        </p>
        <p>
          When the lock is done, if the orientation actually changed, the
          <a>user agent</a> MUST <a>fire a simple event</a> named
          <code>orientationnchange</code> at the <code>Screen</code> object.
        </p>
      </section>
      <section>
        <h2>
          Default orientation
        </h2>
        <p>
          The <a>browsing context</a>'s <dfn>default orientation</dfn> is the
          set of orientations to which the screen orientation would be locked
          when it is not explicitly locked by the current <a>browsing
          context</a>.
        </p>
      </section>
    </section>
    <section>
      <h2>
        Extensions to the <a>Screen</a> Interface
      </h2>The CSSOM View specification defines a <code>Screen</code> interface
      [[!CSSOM-VIEW]], which this specification extends:
      <dl class='idl' title='partial interface Screen : EventTarget'>
        <dt>
          readonly attribute DOMString orientation
        </dt>
        <dt>
          boolean lockOrientation(DOMString orientation)
        </dt>
        <dt>
          void unlockOrientation()
        </dt>
        <dt>
          attribute EventHandler onorientationchange
        </dt>
      </dl>
      <p>
        The <code>orientation</code> attribute MUST return the value
        representing the orientation of the screen. The returned orientation
        MUST be in the <a>current orientation</a> list.
      </p>
      <p>
        The <code>lockOrientation()</code> method, when invoked, MUST run the
        steps for <a>locking the screen orientation</a> using <i>orientation</i>.
        The method MUST return the result returned from running previous steps.
      </p>
      <p>
        The <code>unlockOrientation()</code> method, when invoked, MUST
        asynchronously <a>lock the orientation</a> to the <a>default
        orientation</a>. The <a>user agent</a> MAY ignore this call if the
        screen is already locked to the <a>default orientation</a>.
      </p>
      <p>
        When the screen orientation changes in the current <a>browsing
        context</a>, the <a>user agent</a> MUST <a>queue a task</a> which
        updates the <code>orientation</code> attribute and <a>fire a simple
        event</a> named <code>orientationchange</code> at the
        <code>Screen</code> object.
      </p>
      <div class="note">
        <p>
          For example, that means if an application A is locked to
          <code>landscape-primary</code> and application B is locked to
          <code>portrait-primary</code>, switching from application A to B or B
          to A will not fire an <code>orientationchange</code> event because
          both applications will keep the orientation they had.
        </p>
        <p>
          However, locking the orientation can fire an
          <code>orientationchange</code> if the orientation had to be changed
          to satisfy the lock requirements.
        </p>
      </div>
      <section>
        <h2>
          Locking the screen orientation
        </h2>
        <p>
          The steps for <dfn>locking the screen orientation</dfn> are as
          follows:
        </p>
        <ol>
          <li>If the <a>user agent</a> does not allow the current <a>browsing
          context</a> to lock the screen orientation, the steps MUST stop here
          and return false. For example, a <a>user agent</a> might only allow
          <a>browsing context</a> in a fullscreen state to lock the screen
          orientation or <a>browsing context</a> with elevated privileges.</li>
          <li>Let <i>orientations</i> be the list of locking orientations.
          </li>
          <li>For each <i>orientation</i> in the <i>orientations</i> list, run
          the following sub steps:
            <ol>
              <li>If <i>orientation</i> isn't part of the <a>allowed
              orientations</a>, the steps MUST stop here and return false.
              </li>
              <li>If <i>orientation</i> is <i>portrait</i> or <i>landscape</i>
              the value MUST be removed from <i>orientations</i> and every
              <a>allowed orientations</a> it is representing MUST be inserted
              in <i>orientations</i>.
              </li>
            </ol>
          </li>
          <li>Return true and run the remaining steps asynchronously.
          </li>
          <li>The <a>user agent</a> MUST <a>lock the orientation</a> to
          <i>orientations</i>.
          </li>
        </ol>
      </section>
    </section>
    <section class='informative'>
      <h2>
        Declarative orientation locking
      </h2>
      <p>
        This specification doesn't intend to specify a declarative orientation
        locking. However, other specifications specify ways to do that.
      </p>
      <p>
        The Web Application Manifest Format and Management APIs
        [[!WEBAPPS-MANIFEST-API]] specifies a way to declare a default
        orientation for a web application inside the manifest file. That
        specification tries to follow this specification regarding orientation
        keywords.
      </p>
      <p>
        The CSS Device Adaptation specification [[!CSS-ADAPTATION]] specifies a
        way to declare a default orientation for a web page. That specification
        isn't yet in sync with this specification.
      </p>
    </section>
    <section>
      <h2>
        Event handlers
      </h2>
      <p>
        The following are the <a>event handlers</a> (and their corresponding
        <a>event handler event types</a>) that MUST be supported as attributes
        by the <code>Screen</code> object:
      </p>
      <table class="simple">
        <thead>
          <tr>
            <th>
              event handler
            </th>
            <th>
              event handler event type
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <strong><code>onorientationchange</code></strong>
            </td>
            <td>
              <code>orientationchange</code>
            </td>
          </tr>
        </tbody>
      </table>
    </section>
    <section class='appendix'>
      <h2>
        Acknowledgments
      </h2>
      <p>
        Thanks to Marcos Cáceres, Christophe Dumez, Anne van Kesteren and
        Chundong Wang for their useful comments.
      </p>
      <p>
        Special thanks to Chris Jones and Jonas Sicking for their contributions
        to the initial design of this API.
      </p>
    </section>
  </body>
</html>
