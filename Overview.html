<!DOCTYPE html>
<html>
  <head>
    <title>
      The Screen Orientation API
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' class=
    'remove'>
    </script>
    <script class='remove'>
      var respecConfig = {
        specStatus:           "ED",
        shortName:            "screen-orientation",

        publishDate:          "2014-02-17",
        previousPublishDate:  "2012-12-06",
        previousMaturity:     "WD",
        edDraftURI:           "http://dvcs.w3.org/hg/screen-orientation/raw-file/tip/Overview.html",

        // if this is a LCWD, uncomment and set the end of its review period
        // lcEnd: "20015-08-05",
        noIDLIn:       true,
        noLegacyStyle: true,

        editors:  [
            {
              name: "Mounir Lamouri",
              company: "Google Inc.",
              companyURL: "http://google.com/",
              note: "previously Mozilla",
            },
        ],

        wg:           "Web Applications Working Group",
        wgURI:        "http://www.w3.org/2008/webapps/",
        wgPublicList: "public-webapps",
        wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/42538/status",
      };
    </script>
  </head>
  <body>
    <section id='abstract'>
      The <cite>Screen Orientation API</cite> provides the ability to read the
      screen orientation state, to be informed when this state changes, and to
      be able to lock the screen orientation to a specific state.
    </section>
    <section id='sotd'>
      This document is still in a work in progress state. You can have a look at
      the <a href='https://www.w3.org/Bugs/Public/buglist.cgi?bug_status=UNCONFIRMED&bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&component=Screen%20Orientation&product=WebAppsWG'>
      opened bugs</a>. If you see any problem that is not in that list, feel
      free to discuss it in the mailing list (see below) or <a href='https://www.w3.org/Bugs/Public/enter_bug.cgi?product=WebAppsWG&component=Screen%20Orientation'>
      open a new bug</a>.
    </section>
    <section class='informative'>
      <h2>
        Introduction
      </h2>
      <p>
        The Screen Orientation API provides an interface for web applications
        to access and lock the device's screen orientation state.
      </p>
      <p>
        This examples is an application that shows the current screen
        orientation to the user every time the screen orientation state
        changes:
      </p>
      <pre class='example highlight'>
        &lt;!DOCTYPE html&gt;
        &lt;html&gt;
          &lt;head&gt;
            &lt;title&gt;Screen Orientation API Example 1&lt;/title&gt;
            &lt;script&gt;
              function show() {
                alert("Screen orientation state is now " + screen.orientation);
              }

              screen.addEventListener("orientationchange", show);
              window.addEventListener("load", show);
            &lt;/script&gt;
          &lt;/head&gt;
          &lt;body&gt;
            &lt;input type='button' value='Unlock'
              onclick='screen.unlockOrientation();'&gt;
            &lt;input type='button' value='Lock to portrait'
              onclick="screen.lockOrientation('portrait');"&gt;
            &lt;input type='button' value='Lock to landscape'
              onclick="screen.lockOrientation('landscape');"&gt;
          &lt;/body&gt;
        &lt;/html&gt;

</pre>
    </section>
    <section id='conformance'>
      <p>
        This specification defines conformance criteria that apply to a single
        product: the <dfn>user agent</dfn> that implements the interfaces that
        it contains.
      </p>
      <p>
        Implementations that use ECMAScript to expose the APIs defined in this
        specification MUST implement them in a manner consistent with the
        ECMAScript Bindings defined in the Web IDL specification [[!WEBIDL]].
      </p>
    </section>
    <section>
      <h2>
        Terminology
      </h2>
      <p>
        The <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#eventhandler">EventHandler</a></dfn>
        interface represents a callback used for event handlers as defined in
        [[!HTML5]].
      </p>
      <p>
        The concepts <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#queue-a-task">queue a
        task</a></dfn> and <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#fire-a-simple-event">fire
        a simple event</a></dfn> are defined in [[!HTML5]].<br>
        Unless specified otherwise, when queuing a task, the <dfn>screen
        orientation task source</dfn> is used.
      </p>
      <p>
        The terms <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#event-handlers">event
        handlers</a></dfn> and <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#event-handler-event-type">
        event handler event types</a></dfn> are defined in [[!HTML5]].
      </p>
      <p>
        The concepts of <dfn><a href=
        "http://dev.w3.org/html5/spec/browsers.html#browsing-context">browsing
        context</a></dfn> and <dfn><a href=
        "http://dev.w3.org/html5/spec/browsers.html#active-document">active
        document</a></dfn> are defined in [[!HTML5]].
      </p>
      <p>
        Promises objects are defined in [[!ECMASCRIPT]].
      </p>
      <section>
        <h2>
          Types of orientations
        </h2>
        <p>
          At any given time, the screen orientation type MUST be one of the
          following values:
        </p>

        <dl title="enum OrientationType" class="idl">
          <dt>portrait-primary</dt>
          <dd></dd>
          <dt>portrait-secondary</dt>
          <dd></dd>
          <dt>landscape-primary</dt>
          <dd></dd>
          <dt>landscape-secondary</dt>
          <dd></dd>
        </dl>

        <p>
          When the screen width is higher than the screen height, the current
          screen orientation MUST be whether <code>landscape-primary</code> or
          <code>landscape-secondary</code>
        </p>

        <p>
          When the screen height is equal or higher than the screen width, the
          current screen orientation MUST be whether
          <code>portrait-primary</code> or <code>portrait-secondary</code>.
        </p>

        <p>
          The decision whether the screen orientation type is
          <code>*-primary</code> or <code>*-secondary</code> is up to the
          <a>user agent</a>. For example, it can be based on the device
          preferred angles, the user's preferred orientations or the current
          orientation when the applications starts. However, a <a>user agent</a>
          MUST keep the screen orientation types and the screen orientation
          angles relation constant during the lifetime of the
          <code>Screen</code> object.
        </p>

        <p>
          It is good practice when using this API to not assume any relationship
          between the screen orientation type and the screen orientation angle.
        </p>
      </section>
      <section>
        <h2>
          Types of orientation locks
        </h2>
        <p>
          The screen orientation MUST be lockable to all of the following types:
        </p>

        <dl title="enum OrientationLockType" class="idl">
          <dt>any</dt>
          <dd></dd>
          <dt>landscape</dt>
          <dd></dd>
          <dt>portrait</dt>
          <dd><dd>
          <dt>portrait-primary</dt>
          <dd></dd>
          <dt>portrait-secondary</dt>
          <dd></dd>
          <dt>landscape-primary</dt>
          <dd></dd>
          <dt>landscape-secondary</dt>
          <dd></dd>
        </dl>

        <p>
          When the <a>user agent</a> has to <dfn>apply an orientation lock</dfn>
          using <i>orientation</i>, it MUST follow the following step:
        </p>

        <ul>
          <li>
            If <i>orientation</I> is of a value that is also part of
            <code>OrientationType</code>, the <a>user agent</a> MUST <a>lock the
            orientation</a> to <i>orientation</i>.
          </li>
          <li>
            If <i>orientation</i> is <code>landscape</code>, the
            <a>user agent</a> MUST <a>lock the orientation</a> to
            <code>landscape-primary</code> or <code>landscape-secondary</code>
            and SHOULD allow the user to switch from one to the other depending
            on the device orientation, unless the platform conventions say
            otherwise.
          </li>
          <li>
            If <i>orientation</i> is <code>portrait</code>, the
            <a>user agent</a> MUST <a>lock the orientation</a> to
            <code>portrait-primary</code> or <code>portrait-secondary</code> and
            SHOULD allow the user to switch from one to the other depending on
            the device orientation, unless the platform conventions say
            otherwise.
          </li>
          <li>
            If <i>orientation</i> is <code>any</code>, the <a>user agent</a>
            MUST ignore the previous locks and allow the screen orientation to
            change based on the device orientation and SHOULD change the current
            screen orientation if it does not match the one associated with the
            current device orientation, unless the platform conventions say
            otherwise.
          </li>
        </ul>

        <p>
          Applying an orientation lock might change the screen orientation, in
          which case, the <a>user agent</a> MUST fire an event as described
          below.
        </p>
      </section>
      <section>
        <h2>
          Locking the orientation
        </h2>
        <p>
          To <dfn>lock the orientation</dfn> means forcing the rendering of the
          current <a>browsing context</a> to behave as if the screen was
          naturally orientated in a given <code>OrientationType</code> even if
          the device orientation might be different. When locking the
          orientation, the previous locks are ignored.
        </p>
        <p>
          If the lock allows the user to switch between multiple orientations
          and the current device orientation is in a state that would normally
          get the screen orientation to change to one of those, the <a>user
          agent</a> MUST <a>lock the orientation</a> to this new orientation and
          allow the user to continue switching orientations.
        </p>
      </section>
      <section>
        <h2>
          Default orientation
        </h2>
        <p>
          The <a>browsing context</a>'s <dfn>default orientation</dfn> is the
          set of orientations to which the screen orientation would be locked
          when it is not explicitly locked by the current <a>browsing
          context</a>.
        </p>
      </section>
    </section>
    <section>
      <h2>
        Extensions to the <a>Screen</a> Interface
      </h2>The CSSOM View specification defines a <code>Screen</code> interface
      [[!CSSOM-VIEW]], which this specification extends:
      <dl class='idl' title='partial interface Screen : EventTarget'>
        <dt>
          readonly attribute OrientationType orientation
        </dt>
        <dt>
          Promise<OrientationType> lockOrientation(OrientationLockType orientation)
        </dt>
        <dt>
          void unlockOrientation()
        </dt>
        <dt>
          attribute EventHandler onorientationchange
        </dt>
      </dl>
      <p>
        The <code>orientation</code> attribute MUST return the value
        representing the current screen orientation.
      </p>
      <p>
        The <code>lockOrientation()</code> method, when invoked, MUST run the
        following steps:
        <ol>
          <li>If the <a>user agent</a> does not allow the current <a>browsing
          context</a> to lock the screen orientation, return a promise rejected
          with a <code>DOMException</code> whose name is
          <code>"SecurityError"</code> and stop these steps. For example, a
          <a>user agent</a> might only allow <a>browsing context</a> in a
          fullscreen state to lock the screen orientation or <a>browsing
          context</a> with elevated privileges.</li>
          <li>Let <i>promise</i> be a newly-created promise and return it.</li>
          <li>If another promise is currently waiting for an orientation change
          following an orientation lock, this promise MUST be rejected with a
          <code>DOMException</code> whose name is <code>"AbortError"</code>.
          </li>
          <li>The <a>user agent</a> MUST <a>apply an orientation lock</a> using
          <i>orientation</i>.</li>
          <li>After applying the orientation lock, if it is not expected that
          the orientation changes, resolve <i>promise</i> with the current
          orientation. Otherwise, when the orientation changes, resolve
          <i>promise</i> with the new orientation. The <a>user agent</a> MUST
          resolve the promise before firing the <code>orientationchange</code>
          event.</li>
        </ol>
      </p>
      <p>
        The <code>unlockOrientation()</code> method, when invoked, MUST
        asynchronously <a>lock the orientation</a> to the <a>default
        orientation</a>. The <a>user agent</a> MAY ignore this call if the
        screen is already locked to the <a>default orientation</a>. If another
        promise is currently waiting for an orientation change following an
        orientation lock, this promise must be rejected with a
        <code>DOMException</code> whose name is <code>"AbortError"</code>.
      </p>
      <p>
        When the screen orientation changes in the current <a>browsing
        context</a>, the <a>user agent</a> MUST <a>queue a task</a> which
        updates the <code>orientation</code> attribute and <a>fire a simple
        event</a> named <code>orientationchange</code> at the
        <code>Screen</code> object.
      </p>
      <div class="note">
        <p>
          For example, that means if an application A is locked to
          <code>landscape-primary</code> and application B is locked to
          <code>portrait-primary</code>, switching from application A to B or B
          to A will not fire an <code>orientationchange</code> event because
          both applications will keep the orientation they had.
        </p>
        <p>
          However, locking the orientation can fire an
          <code>orientationchange</code> if the orientation had to be changed
          to satisfy the lock requirements.
        </p>
      </div>
    </section>
    <section class='informative'>
      <h2>
        Declarative orientation locking
      </h2>
      <p>
        This specification doesn't intend to specify a declarative orientation
        locking. However, other specifications specify ways to do that.
      </p>
      <p>
        The Web Application Manifest Format and Management APIs
        [[!WEBAPPS-MANIFEST-API]] specifies a way to declare a default
        orientation for a web application inside the manifest file. That
        specification tries to follow this specification regarding orientation
        keywords.
      </p>
      <p>
        The CSS Device Adaptation specification [[!CSS-ADAPTATION]] specifies a
        way to declare a default orientation for a web page. That specification
        isn't yet in sync with this specification.
      </p>
    </section>
    <section>
      <h2>
        Event handlers
      </h2>
      <p>
        The following are the <a>event handlers</a> (and their corresponding
        <a>event handler event types</a>) that MUST be supported as attributes
        by the <code>Screen</code> object:
      </p>
      <table class="simple">
        <thead>
          <tr>
            <th>
              event handler
            </th>
            <th>
              event handler event type
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <strong><code>onorientationchange</code></strong>
            </td>
            <td>
              <code>orientationchange</code>
            </td>
          </tr>
        </tbody>
      </table>
    </section>
    <section class='appendix'>
      <h2>
        Acknowledgments
      </h2>
      <p>
        Thanks to Marcos Cáceres, Christophe Dumez, Anne van Kesteren and
        Chundong Wang for their useful comments.
      </p>
      <p>
        Special thanks to Chris Jones and Jonas Sicking for their contributions
        to the initial design of this API.
      </p>
    </section>
  </body>
</html>
