<!DOCTYPE html>
<html>
  <head>
    <title>
      The Screen Orientation API
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' class=
    'remove'>
    </script>
    <script class='remove'>
      var respecConfig = {
        specStatus:           "ED",
        shortName:            "screen-orientation",

        publishDate:          "2014-02-17",
        previousPublishDate:  "2012-12-06",
        previousMaturity:     "WD",
        edDraftURI:           "http://dvcs.w3.org/hg/screen-orientation/raw-file/tip/Overview.html",

        // if this is a LCWD, uncomment and set the end of its review period
        // lcEnd: "20015-08-05",
        noIDLIn:       true,
        noLegacyStyle: true,

        editors:  [
            {
              name: "Mounir Lamouri",
              company: "Google Inc.",
              companyURL: "http://google.com/",
              note: "previously Mozilla",
            },
        ],

        wg:           "Web Applications Working Group",
        wgURI:        "http://www.w3.org/2008/webapps/",
        wgPublicList: "public-webapps",
        wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/42538/status",
      };
    </script>
  </head>
  <body>
    <section id='abstract'>
      The <cite>Screen Orientation API</cite> provides the ability to read the
      screen orientation state, to be informed when this state changes, and to
      be able to lock the screen orientation to a specific state.
    </section>
    <section id='sotd'>
      This document is still in a work in progress state. You can have a look at
      the <a href='https://www.w3.org/Bugs/Public/buglist.cgi?bug_status=UNCONFIRMED&bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&component=Screen%20Orientation&product=WebAppsWG'>
      opened bugs</a>. If you see any problem that is not in that list, feel
      free to discuss it in the mailing list (see below) or <a href='https://www.w3.org/Bugs/Public/enter_bug.cgi?product=WebAppsWG&component=Screen%20Orientation'>
      open a new bug</a>.
    </section>
    <section class='informative'>
      <h2>
        Introduction
      </h2>
      <p>
        The Screen Orientation API provides an interface for web applications
        to access and lock the device's screen orientation state.
      </p>
      <p>
        This examples is an application that shows the current screen
        orientation to the user every time the screen orientation state
        changes:
      </p>
      <pre class='example highlight'>
        &lt;!DOCTYPE html&gt;
        &lt;html&gt;
          &lt;head&gt;
            &lt;title&gt;Screen Orientation API Example 1&lt;/title&gt;
            &lt;script&gt;
              function show() {
                alert("Screen orientation state is now " + screen.orientation);
              }

              screen.addEventListener("orientationchange", show);
              window.addEventListener("load", show);
            &lt;/script&gt;
          &lt;/head&gt;
          &lt;body&gt;
            &lt;input type='button' value='Unlock'
              onclick='screen.unlockOrientation();'&gt;
            &lt;input type='button' value='Lock to portrait'
              onclick="screen.lockOrientation('portrait');"&gt;
            &lt;input type='button' value='Lock to landscape'
              onclick="screen.lockOrientation('landscape');"&gt;
          &lt;/body&gt;
        &lt;/html&gt;

</pre>
    </section>
    <section id='conformance'>
      <p>
        This specification defines conformance criteria that apply to a single
        product: the <dfn>user agent</dfn> that implements the interfaces that
        it contains.
      </p>
      <p>
        Implementations that use ECMAScript to expose the APIs defined in this
        specification MUST implement them in a manner consistent with the
        ECMAScript Bindings defined in the Web IDL specification [[!WEBIDL]].
      </p>
    </section>
    <section>
      <h2>
        Terminology
      </h2>
      <p>
        The <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#eventhandler">EventHandler</a></dfn>
        interface represents a callback used for event handlers as defined in
        [[!HTML5]].
      </p>
      <p>
        The concepts <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#queue-a-task">queue a
        task</a></dfn> and <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#fire-a-simple-event">fire
        a simple event</a></dfn> are defined in [[!HTML5]].<br>
        Unless specified otherwise, when queuing a task, the <dfn>screen
        orientation task source</dfn> is used.
      </p>
      <p>
        The terms <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#event-handlers">event
        handlers</a></dfn> and <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#event-handler-event-type">
        event handler event types</a></dfn> are defined in [[!HTML5]].
      </p>
      <p>
        The concepts of <dfn><a href=
        "http://dev.w3.org/html5/spec/browsers.html#browsing-context">browsing
        context</a></dfn> and <dfn><a href=
        "http://www.w3.org/html/wg/drafts/html/master/browsers.html#top-level-browsing-context">
        top-level browsing context</a></dfn> are defined in [[!HTML5]].
      </p>
      <p>
        Promises objects are defined in [[!ECMASCRIPT]].
      </p>
      <p>
        The term of <dfn><a href=
        'http://www.w3.org/TR/fullscreen/#fullscreen-element-stack'>fullscreen
        element stack</a></dfn> is defined in [[!FULLSCREEN]].
      </p>
    </section>

    <section>
      <h2>Concepts</h2>
      <section>
        <h2>
          Reading the screen orientation
        </h2>

        <p>
          The screen orientation has two components. The orientation type and
          the orientation angle. Both can be accessed from an
          <code>OrientationInformation</code> instance.
        </p>

        <dl title="interface OrientationInformation" class="idl">
          <dt>readonly attribute OrientationType type</dt>
          <dd></dd>
          <dt>readonly attribute OrientationAngle angle</dt>
          <dd></dd>
        </dl>

        <p>
          The <code>type</code> attribute MUST return the <a>current screen
          orientation type</a>.
        </p>

        <p>
          The <code>angle</code> attribute MUST return the <a>current screen
          orientation angle</a>.
        </p>

        <p>
          For a given <a>browsing context</a>, the values of <code>type</code>
          and <code>angle</code> will be strongly linked in the sense that for
          any given type, there will be a specific angle associated. However,
          the <a>user agent</a> can associate <code>*-primary</code> and <code>
          *-secondary</code> values at will. For example, if <code>90</code>
          is associated with <code>landscape-primary</code> and <code>270</code>
          with <code>landscape-secondary</code> for one browsing context,
          another one might get the opposite relationship.
        </p>

        <p>
          It is also worth noting that even if <code>90</code> and <code>270
          </code> might be associated with <code>landscape</code> types for one
          specific devices, they might be associated with <code>portrait</code>
          types with others.
        </p>

        <p>
          It is then considered good practice to never assume any kind of
          relationship between the screen orientation type and the screen
          orientation angle.
        </p>

        <dl title="enum OrientationType" class="idl">
          <dt>portrait-primary</dt>
          <dd></dd>
          <dt>portrait-secondary</dt>
          <dd></dd>
          <dt>landscape-primary</dt>
          <dd></dd>
          <dt>landscape-secondary</dt>
          <dd></dd>
        </dl>

        <p>
          When reading the <dfn>current screen orientation type</dfn>, the <a>
          user agent</a> MUST follow these steps:
          <ol>
            <li>If the screen width is greater than the screen height, these
            steps MUST return <code>landscape-primary</code> or <code>
            landscape-secondary</code> and terminate these steps.</li>
            <li>If the screen width is lower than or equal to the screen height,
            these steps MUST return <code>portrait-primary</code> or <code>
            portrait-secondary</code>.</li>
          </ol>
        </p>

        <p>
          The decision whether the screen orientation type is
          <code>*-primary</code> or <code>*-secondary</code> is up to the
          <a>user agent</a>. For example, it can be based on the device
          preferred angles, the user's preferred orientations or the current
          orientation when the applications starts. However, a <a>user agent</a>
          MUST keep the screen orientation types and the screen orientation
          angles relation consistent for any given <a>browsing context</a>.
        </p>

        <dl title="enum OrientationAngle" class="idl">
          <dt>0</dt>
          <dd></dd>
          <dt>90</dt>
          <dd></dd>
          <dt>180</dt>
          <dd></dd>
          <dt>270</dt>
          <dd></dd>
        </dl>

        <p>
          When reading the <dfn>current screen orientation angle</dfn>, the <a>
          user agent</a> MUST return the clockwise angle between the orientation
          of the screen as it is drawn and the natural orientation of the device
          (ie. the top of the physical screen). This is the opposite of the
          physical rotation. In other words, if you turn a device 90 degrees on
          the right, screen orientation angle should be 270 degrees.
        </p>
      </section>
      <section>
        <h2>
          Locking the screen orientation
        </h2>

        <p>
          The screen orientation MUST be lockable to all of the following values:
        </p>

        <dl title="enum OrientationLockType" class="idl">
          <dt>any</dt>
          <dd></dd>
          <dt>landscape</dt>
          <dd></dd>
          <dt>portrait</dt>
          <dd><dd>
          <dt>portrait-primary</dt>
          <dd></dd>
          <dt>portrait-secondary</dt>
          <dd></dd>
          <dt>landscape-primary</dt>
          <dd></dd>
          <dt>landscape-secondary</dt>
          <dd></dd>
          <dt>0</dt>
          <dd></dd>
          <dt>90</dt>
          <dd></dd>
          <dt>180</dt>
          <dd></dd>
          <dt>270</dt>
          <dd></dd>
        </dl>

        <p>
          When the <a>user agent</a> has to <dfn>apply an orientation lock</dfn>
          using <i>orientation</i>, it MUST run the following step:
        </p>

        <ol>
          <li>The <a>user agent</a> MAY require the current <a>top-level
          browsing context</a> to be fullscreen [[!FULLSCREEN]], in which case,
          it MUST run the following sub-steps:</li>
          <ol>
            <li>Let <i>doc</i> be the <a>top-level browsing context</a>'s
            document.</i>
            <li>If <i>doc</i> has an empty <a>fullscreen element stack</a>,
            return a Promise rejected with a <code>DOMException</code> whose
            name is <code>SecurityError</code> and abort these steps.</li>
            <li>The next time <i>doc</i> receives a <code>fullscreenchange
            </code> event, when fullscreen is exited, the <a>user agent</a> MUST
            <a>lock the orientation</a> to the <a>default orientation</a>.</li>
          </ol>
          <li>Let <i>promise</i> be a newly-created promise and return it.</li>
          <li>If a promise previously created in these steps is pending, it MUST
          be rejected with a <code>DOMException</code> whose name is <code>
          AbortError</code>.</li>
          <li>One of the following sub-steps MUST be run asynchronously,
          depending on <i>orientation</i>'s value:</li>
            <ul>
              <li>If <i>orientation</i> is <code>landscape</code>, the
              <a>user agent</a> MUST <a>lock the orientation</a> to
              <code>landscape-primary</code>, <code>landscape-secondary</code>
              or both, depending on the platform conventions.</li>
              <li>If <i>orientation</i> is <code>portrait</code>, the
              <a>user agent</a> MUST <a>lock the orientation</a> to
              <code>portrait-primary</code>, <code>portrait-secondary</code>
              or both, depending on the platform conventions.</li>
              <li>If <i>orientation</i> is <code>any</code>, the <a>user agent
              </a> MUST <a>lock the orientation</a> to <code>portrait-primary
              </code>, <code>portrait-secondary</code>, <code>landscape-primary
              </code> and <code>landscape-secondary</code>.</li>
              <li>Otherwise, the <a>user agent</a> MUST <a>lock the orientation
              </a> to <i>orientation</i>.</li>
            </ul>
          <li>Let <i>result</i> be a new instance of <code>
          OrientationInformation</code>.</li>
          <li>If locking the orientation should not provoke an orientation
          change, the <a>user agent</a> MUST resolve <i>promise</i> with <i>
          result</i> and abort these steps.</li>
          <li>Otherwise, the next time the orientation changes, before firing
          the <code>orientationchange</code> event as described below, the
          <a>user agent</a> MUST resolve <i>promise</i> with <i>result</i>.</li>
        </ol>

        <p>
          When the <a>user agent</a> has to <dfn>lock the orientation</dfn>
          using <i>orientations</i>, it MUST run tho following steps:
          <ol>
            <li>If the screen is already locked to <i>orientations</i>, abort
            the steps.</li>
            <li>If <i>orientations</i> contains only one value, run the
            following sub-steps:</li>
              <ol>
                <li>Let <i>orientation</i> be the value contained in <i>
                orientations</i>.</li>
                <li>The <a>user agent</a> MUST change how the viewport is drawn
                such as the <a>current screen orientation type</a> or the <a>
                current screen orientation angle</a> will be equal to <i>
                orientation</i>.</li>
                <li>After the change has happened, the <a>user agent</a> MUST
                prevent the <a>top-level browsing context</a> screen orientation
                to change until those steps are run again.</li>
                <li>Abort these steps.</li>
              </ol>
            <li>If neither the <a>current screen orientation type</a> nor the
            <a>current screen orientation angle</a> values are part of <i>
            orientations</i>, the <a>user agent</a> MUST change how the viewport
            is drawn such as the <a>current screen orientation type</a> or the
            <a>current screen orientation angle</a> will be equal to one of <i>
            orientations</i>' values.</li>
            <li>Otherwise, depending on platform conventions, the <a>user agent
            </a> MAY change how the viewport is drawn in order to make it match
            another screen orientation type or angle. However, it MUST be part
            of <i>orientations</i>.</li>
            <li>The <a>user agent</a> MUST allow the user to change the screen
            orientation to any value part of <i>orientations</i> and only those
            values until those steps are run again. The method to define what
            the current screen orientation should be MUST match the platform
            conventions.</li>
          </ol>
        </p>
      </section>
      <section>
        <h2>
          Default orientation
        </h2>
        <p>
          The <a>browsing context</a>'s <dfn>default orientation</dfn> is the
          set of orientations to which the screen orientation would be locked
          when it is not explicitly locked by the current <a>browsing
          context</a>.
        </p>

        <p>
          For the perspective of the current <a>browsing context</a>, locking to
          the default orientation is equivalent to unlocking because it means
          that it no longer have any lock applied. However, it does not mean
          that the <a>default orientation</a> has to be <code>any</code>.
        </p>
      </section>
      <section>
        <h2>TODO</h2>
        <ul>
          <li>Orientation change</li>
          <li>Lock lifetime</li>
        </ul>
      </section>
    </section>
    <section>
      <h2>
        Extensions to the <a>Screen</a> Interface
      </h2>The CSSOM View specification defines a <code>Screen</code> interface
      [[!CSSOM-VIEW]], which this specification extends:
      <dl class='idl' title='partial interface Screen : EventTarget'>
        <dt>
          readonly attribute OrientationInformation orientation
        </dt>
        <dt>
          Promise&lt;OrientationInformation&gt; lockOrientation(OrientationLockType orientation)
        </dt>
        <dt>
          void unlockOrientation()
        </dt>
        <dt>
          attribute EventHandler onorientationchange
        </dt>
      </dl>

      <p>
        The <code>lockOrientation()</code> method, when invoked, MUST run the
        <a>apply an orientation lock</a> steps using <i>orientation</i> and
        return the result of those steps.
      </p>

      <p>
        The <code>unlockOrientation()</code> method, when invoked, MUST
        asynchronously <a>lock the orientation</a> to the <a>default
        orientation</a>. If a promise created by <a>apply an orientation lock
        </a> steps is pending, it MUST be rejected with a <code>DOMException
        </code> whose name is <code>AbortError</code>.
      </p>

      <p>
        When the screen orientation changes in the current <a>browsing
        context</a>, the <a>user agent</a> MUST <a>queue a task</a> which
        updates the <code>orientation</code> attribute and <a>fire a simple
        event</a> named <code>orientationchange</code> at the
        <code>Screen</code> object.
      </p>

      <div class="note">
        <p>
          For example, that means if an application A is locked to
          <code>landscape-primary</code> and application B is locked to
          <code>portrait-primary</code>, switching from application A to B or B
          to A will not fire an <code>orientationchange</code> event because
          both applications will keep the orientation they had.
        </p>
        <p>
          However, locking the orientation can fire an
          <code>orientationchange</code> if the orientation had to be changed
          to satisfy the lock requirements.
        </p>
      </div>
    </section>
    <section class='informative'>
      <h2>
        Interaction with DeviceOrientation
      </h2>

      <p>
        The DeviceOrientation specification [[!DEVICE-ORIENTATION]] defines a
        <code>deviceorientation</code> event that can be used to discover the
        physical orientation of the device. Such event can be used to draw
        things on the screen that could point to a specific direction. A basic
        example being a compass application. Another example would be an
        application giving direction to the user or an augmented reality game
        pointing to an objective.
      </p>

      <p>
        Drawing on the screen in order to point to a physical location requires
        to know the device orientation and the orientation of the screen in the
        device coordinates. Without the APIs defined in this specification, a
        developer has to assume that the <a>current screen orientation angle</a>
        is 0. With the help of the APIs described in this specification, the
        developer can <a>apply an orientation lock</a> using <code>0</code> to
        make that assumption a certitude. Otherwise, reading the <a>current
        screen orientation angle</a> via <code>screen.orientation.angle</code>
        and listening to the <code>orientationchange</code> should help the
        developer to compensate the screen orientation angle.
      </p>
    </section>
    <section class='informative'>
      <h2>
        Interaction with Web Application Manifest
      </h2>

      <p>
        The Web Application Manifest specification [[!WEBAPPS-MANIFEST-API]]
        allows web applications to set the <a>default orientation</a>.
      </p>
    </section>
    <section class='informative'>
      <h2>
        Interaction with CSS Device Adaptation
      </h2>

      <p>
        The CSS Device Adaptation specification [[!CSS-ADAPTATION]] defines,
        independently of this document, a way to lock the screen orientation for
        a web page using CSS.
      </p>
    </section>
    <section>
      <h2>
        Event handlers
      </h2>
      <p>
        The following are the <a>event handlers</a> (and their corresponding
        <a>event handler event types</a>) that MUST be supported as attributes
        by the <code>Screen</code> object:
      </p>
      <table class="simple">
        <thead>
          <tr>
            <th>
              event handler
            </th>
            <th>
              event handler event type
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <strong><code>onorientationchange</code></strong>
            </td>
            <td>
              <code>orientationchange</code>
            </td>
          </tr>
        </tbody>
      </table>
    </section>
    <section class='appendix'>
      <h2>
        Acknowledgments
      </h2>
      <p>
        Thanks to Marcos Cáceres, Christophe Dumez, Anne van Kesteren and
        Chundong Wang for their useful comments.
      </p>
      <p>
        Special thanks to Chris Jones and Jonas Sicking for their contributions
        to the initial design of this API.
      </p>
    </section>
  </body>
</html>
